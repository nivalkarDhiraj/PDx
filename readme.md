# API Development

The API has been developed using .Net core 3.1 framework.

The service has three endpoints. The auth endpoint can be used to generate token, patient for patient CRUD operation and lab report for lab report CRUD operation.

## Overview

To use this API, please close the code from repository, build it and run on local.

The JWT basic authentication has been implemented to and needs to generate token with valid credential and pass this token as bearer token, to use any API endpoints. The API auth endpoint can be used to generate token by passing credential details as Basic-Auth or using authorization header.

The in-memory cache has been implemented to support all CURD operation, and all data will be loosed once the API is stopped.

## Solution file

The solution file is placed inside folder (HCA.PlatformDigital) which can be used to open/explore all projects.

## Sample Payload

The sample payload for each controller method is added in folder SamplePayload to test API.


## Documentation


The swagger has been implemented for API documentation purpose. The swagger endpoint is the default endpoint ({baseurl}/pd/swagger) on local when executed. The swagger main page can be used to refer the sample payload for endpoints. 

Please follow below steps to test the service: 

### Auth Controller


baseurl/auth: Please use this endpoint to generate token by providing valid credential as basic-auth as HttpHeader parameters. Please refer appsettings.json file with section identityconfiguration and key (email, accesskey) as credential.

baseurl/auth/token: This method is used to generate token by providing the identity credential in body as Json.

### Patient Controller


{baseurl}/patient/create: This endpoint can be used to create patient with below payload.

{
  "patientId": "",
  "name": "James John",
  "dob": "1972-10-15",
  "isMale": true,
  "contactNo": ""
}

Patient name and DOB are required field, patient id will be autogenerated. 

{baseurl}/patient/update: This endpoint can be used to update patient details and below sample payload can be for this.

{
  "patientId": "",
  "name": "James John",
  "dob": "1972-10-15",
  "isMale": true,
  "contactNo": ""
}

The patient id, name and DOB are required field. The patient already created can be updated only based on auto-generated patient id. 


{baseurl}/patient/delete: This endpoint can be used to delete patient already created. Please refer below endpoint and parameter to delete patient.

/delete/{patientId}

A valid patient id needs to be passed as route parameter to delete patient. You can verify patient is deleted or not can refer patient list endpoint. 

{baseurl}/patient/get: This endpoint can be used to get list of patients. 


{baseurl}/patient/get/{patientid}: This endpoint can be used to get specific patient details by patient id. 

{baseurl}/patient/filter/{testname}/{startDate}/{endDate}: This endpoint can be used to filter patients list who have conducted specific test and with test date range. 

The test name is mandatory parameter for this endpoint and date range (sate date and end date) is optional.

### LabReport Controller


{baseurl}/labreport/create: This endpoint can be used to create lab report for a patient and patient should exists in the system. The below payload can be used to create lab report.

{
  "reportId": "",
  "reportName": "Blood Test",
  "reportTime": "2021-01-01T07:16:59.706Z",
  "patientId": "6d349d02-53b1-407f-bedb-2668b4d988b4", -- actual patient id
  "labTests": [
    {
      "testName": "CBC",
      "testDateTime": "2021-09-14T07:16:59.706Z",
      "tests": [
        {
          "name": "WHITE BLOOD CELL COUNT",
          "result": "3.9",
          "resultExpected": "3.8-10.8 Thousand/uL",
          "technology": "PHOTOMETRY",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "RED BLOOD CELL COUNT",
          "result": "5.24",
          "resultExpected": "4.20 - 5.80 Million/uL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC TEST",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "HEMOGLOBIN",
          "result": "16.5",
          "resultExpected": "13.2 - 17.1 g/dL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "MCV",
          "result": "94.9",
          "resultExpected": "80.0 - 100.0 fL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "Param1",
              "value": "This is to describe more test property"
            }
          ]
        }
      ],
      "description": "desc"
    }
  ]
}


Patient id is required field for this endpoint and patient should exists for which you want to create lab report.

{baseurl}/labreport/update: This endpoint can be used to update 
lab report for a patient. The lab report and patient must exist to update lab report, so please pass valid report id and patient id to update lab report. The below payload can be referred to update lab report.

{
  "reportId": "6d349d02-53b1-407f-bedb-2668b4d988b4",
  "reportName": "Blood Test",
  "reportTime": "2021-01-01T07:16:59.706Z",
  "patientId": "6d349d02-53b1-407f-bedb-2668b4d988b4", -- actual patient id
  "labTests": [
    {
      "testName": "CBC",
      "testDateTime": "2021-09-14T07:16:59.706Z",
      "tests": [
        {
          "name": "WHITE BLOOD CELL COUNT",
          "result": "3.9",
          "resultExpected": "3.8-10.8 Thousand/uL",
          "technology": "PHOTOMETRY",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "RED BLOOD CELL COUNT",
          "result": "5.24",
          "resultExpected": "4.20 - 5.80 Million/uL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC TEST",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "HEMOGLOBIN",
          "result": "16.5",
          "resultExpected": "13.2 - 17.1 g/dL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "",
              "value": ""
            }
          ]
        },
        {
          "name": "MCV",
          "result": "94.9",
          "resultExpected": "80.0 - 100.0 fL",
          "technology": "PH",
          "method": "GOD-PAP METHOD",
          "description": "CBC ",
          "testParameters": [
            {
              "name": "Param1",
              "value": "This is to describe more test property"
            }
          ]
        }
      ],
      "description": "desc"
    }
  ]
}

The lab report is and patient id is required field for this endpoint. You can update lab report test details as well as patient for lab report.

{baseurl}/labreport/delete: This endpoint can be used to delete lab report already created. Please refer below endpoint and parameter to delete lab report.

/delete/{reportId}

The valid report id needs to pass in order to delete a lab report and only lab report will be deleted not the patient.


{baseurl}/labreport/get: This endpoint can be used to get list of lab reports. 

{baseurl}/patient/get/{reportId}: This endpoint can be used to get specific lab report details by report id. 

### Unit Testing

There a test folder in the solution having unit test project for each indivisual components, although some of them have not been completed considering short span of time.

